/* 
 _CLASSNAME_.cpp
 Generated by Cutter from:
     "_ARGS_SOURCE_PATH_"
 at _DATE_TIME_
*/
#include "RixDisplayFilter.h"

class _CLASSNAME_ : public RixDisplayFilter {
public:
	virtual int Init(RixContext &ctx, char const *pluginPath);
	virtual void Finalize(RixContext &ctx);
	virtual RixSCParamInfo const *GetParamTable();
	virtual void CreateInstanceData(RixContext &ctx,
								   char const *handle,
								   RixParameterList const *parms,
								   InstanceData *instanceData);
	static void ReleaseInstanceData(RtPointer data);
	virtual void Filter(RixDisplayFilterContext &fCtx, RtConstPointer data);
	private:
_DECLARE_DSPY_PARAMS_STRUCT_
	};

int _CLASSNAME_::Init(RixContext &ctx, char const *pluginPath) {
	return 0;
	}

void _CLASSNAME_::Finalize(RixContext &ctx) { }

enum paramIndex {
_FILL_PARAM_ENUMERATION_
    };

RixSCParamInfo const *_CLASSNAME_::GetParamTable() {
    static RixSCParamInfo s_ptable[] = {
_FILL_PARAM_TABLE_
        };
    return &s_ptable[0];
    }

void _CLASSNAME_::CreateInstanceData(RixContext &ctx, 
											 char const *handle,
											 RixParameterList const *params,
											 InstanceData *instanceData) {
	// "Install" our dspyParams data structure in the memory pointed
	// to by instanceData.
    instanceData->datalen = sizeof(dspyParams);
    instanceData->data = malloc(instanceData->datalen);
    instanceData->freefunc = free;
    dspyParams *dp = reinterpret_cast< dspyParams* >(instanceData->data);

	// Default values read from the .args file 
_ASSIGN_TO_DSPY_PARAMS_PTR_
_DECLARE_STRINGS_
	// Update values from any connections
_EVAL_INPUTS_
    RixMessages 	*msg = reinterpret_cast< RixMessages* >(ctx.GetRixInterface(k_RixMessages));
	RixRenderState *renderState = static_cast< RixRenderState* >(ctx.GetRixInterface(k_RixRenderState));

	RixRenderState::FrameInfo frameInfo;
	renderState->GetFrameInfo(&frameInfo);
	RixIntegratorEnvironment const *integratorEnv = frameInfo.integratorEnv;

	RixDisplayChannel const *channel;
	if (!(channel = integratorEnv->GetDisplayChannel(_CHANNEL_VARNAME_))) {
		msg->Warning( "%s '%s' did not find a display for AOV '%s'", "_CLASS_NAME_AS_STRING_", handle, _CHANNEL_VARNAME_);
		return -1;
		}
	dp->channelId = channel->id;
	return 0;
	}

void _CLASSNAME_::ReleaseInstanceData(RtPointer data) {
	// Normally empty
	}

void _CLASSNAME_::Filter(RixDisplayFilterContext &fCtx, RtConstPointer instance) {
	dspyParams const *dp = reinterpret_cast< dspyParams const* >(instance);
	
	RtColorRGB origPixel;
	for (int x = fCtx.xmin; x < fCtx.xmax; x++) {
		for (int y= fCtx.ymin; y < fCtx.ymax; y++) {
			// Grab the original pixel value for a specific display channel	
			fCtx.Read(dp->channelId, x, y, origPixel);

			// Use the inputs to calculate a new value.
			/*
_LIST_OF_POINTERS_

			RtColorRGB result = ???;
			fCtx.Write(dp->channelId, x, y, result);
			*/
			}		
		}
	}

RIX_DISPLAYFILTERCREATE {
	return new _CLASSNAME_();
	}

RIX_DISPLAYFILTERDESTROY {
	delete static_cast<_CLASSNAME_*>(filter);
	}
