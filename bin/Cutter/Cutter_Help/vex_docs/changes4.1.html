<!--
 - PROPRIETARY INFORMATION.  This software is proprietary to
 - Side Effects Software Inc., and is not to be reproduced,
 - transmitted, or disclosed in any way without written permission.
 -
 -	Side Effects
 -	477 Richmond Street West
 -	Toronto, Ontario
 -	Canada   M5V 3E7
 -	416-504-9876
 -->

<html>

<head>
   <title> VEX Compiler Reference</title>
</head>

<body bgcolor="#ffffff" text="#000000">

<table width=100%>
<tr>
   <td><img hspace=15 vspace=5 ALT="[SESI logo]" SRC="logo.jpg"</td>
   <td>
      <center>
         <h1>VEX Language Reference - Version 7.0</h1>
	 Side Effects Software Inc.  2004
      </center>
   </td>
</tr>
</table>

<hr>
<center><h1>Changes since Houdini 4.1</h1></center>

These are highlights of major changes since the <a href="changes4.0.html">
4.1 release</a> of houdini.<p>

<menu>
    <li> <a href="#ch_general">General Changes</a>
    <li> <a href="#ch_shading">Shading Context Changes</a>
    <li> <a href="#ch_op">OP Context Changes</a>
</menu>

<a name="ch_general"></a>
<hr>
<center><h1> General Changes</h1></center>
<menu>
    <li> There is a new <a href="compiler.html#cg_pragma">
	<b>export</b> pragma</a> to allow the export of parameters to the
	operation controls bar or the operation parameters dialog.<p>

    <li> There is a new VEX <a href="context.html#ctx_image3d">
	context</a> to generate 3D texture images.<p>

    <li> There is a new VEX context for COP2.<p>

    <li> There are new 3D texture map <a href="functions.html#image3d">
	functions</a> to evaluate/integrate over 3D texture maps.<p>

    <li> There is a new function <b>cracktransform()</b> which will
	take a matrix and decompose it into its component translation
	and Euler angle rotations.<p>

    <li> There are several functions which can access external
	geometry files.
	<menu>
	    <li><b>npoints()</b>
	    <li><b>intersect()</b>
	    <li><b>metaweight()</b>
	    <li><b>prim_normal()</b>
	    <li><b>prim_attribute()</b>
	</menu>
	Please see <a href="functions.html#qr_geo">documentation</a>
	for these functions.<p>

    <li> A new pragma (<a href="compiler.html#pr_callback">#pragma
	callback</a>) has been added to allow hscript commands to be run
	when a toggle button or menu parameter is changed.<p>

    <li> The preprocessor in vcc has had minor alterations regarding
	the pasting operator (##) and now supports the stringize
	operator (#X).<p>

    <li> The preprocessor has a non-ANSI addition to check for the
	existence of <a href="compiler.html#gc_cpp">environment
	variables</a>.  For example:
<listing>
	#if defined(DO_THIS) || environment(DO_THAT)
</listing>
	will evaluate true if DO_THIS has been defined, or if an
	enviornmnet variable DO_THAT is defined on the system.<p>

    <li> The VEXop operator tables are now pre-processed by an
	internal cpp processor.  Standard C/C++ comments are handled
	properly (along with hash-style comments previously
	supported).  It is also possible to add #define, #ifdef, etc.
	statements.  A side-effect of this modification is that the
	include directive should now be prefixed with a hash mark.
	Warnings will be generated by old-style includes (which may
	not be supported in future releases).<p>

    <li> There is an environment variable check for
	<b>HOUDINI_SCRIPT_DEBUG</b>.  Setting this environment
	variable to 1 will cause debugging information to be printed
	out to the console when operator tables are being loaded which
	may help in determining why VEX operators don't show up in
	Houdini.<p>

    <li> The <b>printf</b> and <b>sprintf</b> functions can now print
	integers/floats with leading zeros for the field width.  This
	allows generation of padded file names etc.  For example:
<listing>
	int	ival = 32;
	string mapname = sprintf("somepath.%04d.rat", ival);
</listing>
	will generate "somepath.0032.rat" as the resulting string.<p>
</menu>

<a name="ch_shading"></a>
<hr>
<center><h1> Shading Context Changes</h1></center>
<menu>
    <li> Derivative computation has been improved.  There are now
	<a href="shading.html#ctx_extrapolation">optional
	arguments</a> on most functions which use derivatives to
	control the computation of derivatives.<p>
	The extrapolation option also applies to the cinput()
	functions in the COP/COP2 contexts.<p>

    <li> The texture mapping code now takes an optional argument
	(<b>lerp</b>) which can help to remove discontinuities when
	different MIP levels of .rat files are accessed.  Textures may
	be slightly softer with this option turned on and render times
	may increase.  However, this should remove discontinuities or
	visible jumps in texture mapping.  Please see <a
	href="functions.html#image_filter">the filter options</a> for
	further information.<p>

    <li> In the light and shadow contexts, there is a new function to
	query whether the lighting computation is being used for shading
	fog or surfaces.  This allows users to optimize
	lighting/shadow shading when ray-marching through fog.<p>
	Please see documentation for <b>isfogray()</b>.<p>

    <li> There are new functions in the shading contexts to query the
	transform spaces of other objects.  <b>otransform()</b>,
	<b>ltransform()</b>, <b>ftransform()</b> allow access to the
	world space transforms of geometry, light or fog objects.<p>

    <li> There's a new function <b>getlightname()</b> which returns
	the name of the current light inside illuminance loops.  The
	function will return an empty string outside of illuminance
	loops.<p>

    <li> There's a new function <b>getobjectname()</b> which returns
	the name of the current light, geometry or fog object which
	is being shaded.<p>

    <li> There are new functions to perform ray-intersection tests.
	The <b>rayhittest</b> function will send a ray and return the
	distance to the first intersection.  Optionally, it can also
	return the position and surface normal of the surface
	intersected.<p>

    <li> All ray-tracing functions now take optional arguments which
	can specify the scope of objects to perform intersection tests
	against.  These functions are:<p>
	    <ul>
		<li><b>reflectlight</b>
		<li><b>refractlight</b>
		<li><b>trace</b>
		<li><b>fastshadow</b>
		<li><b>filtershadow</b>
		<li><b>rayhittest</b>
	    </ul><p>

    <li> All illumination functions now take optional arguments which
	can specify the light mask of illuminating lights.  The
	illumination functions affected are:<p>
	    <ul>
		<li>The <b>illuminance()</b> loop
		<li><b>ambient()</b>
		<li><b>blinn()</b>
		<li><b>diffuse()</b>
		<li><b>phong()</b>
		<li><b>specular()</b>
	    </ul><p>

    <li> In the light/shadow contexts, the L variable is now correctly
	 initialized for Houdini lights with orthographic projections.
	 Please see <a href="shading.html#LVariable">here</a> for
	 further information.<p>
</menu>

<a name="ch_op"></a>
<hr>
<center><h1> OP Context Changes</h1></center>
<menu>
    <li> It is now possible to create arbitrarily named attributes in
	Sop and Pop contexts using the <b>addattribute()</b>
	function.<p>
    <li> There is a new VEX context "cop2" to generate VEX code for
	the new compositor.<p>
</menu>

<!-------------------------------------------------------------------!>
<br>
<hr>
<center>
<font size=-2>
  Copyright &#169; 1999-2004 Side Effects Software Inc.<br>
  477 Richmond Street West, Toronto, Ontario, Canada M5V 3E7
</font>
</center>

</body>
</html>
